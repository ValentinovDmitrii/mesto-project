(()=>{"use strict";var e={},t=function(e,t){return t.validity.patternMismatch||t.validity.typeMismatch?t.setCustomValidity(t.dataset.error):t.setCustomValidity(""),t.validity.valid?(r(e,t),!1):(o(e,t,t.validationMessage),!0)},o=function(t,o,r){var n=t.querySelector(".".concat(o.id,"-error"));o.classList.add(e.inputErrorClass),n&&(n.textContent=r,n.classList.add(e.errorClass))},r=function(t,o){var r=t.querySelector(".".concat(o.id,"-error"));o.classList.remove(e.inputErrorClass),r&&(r.classList.remove(e.errorClass),r.textContent="")},n=function(t,o,r){c(t,o)?(r.disabled=!0,r.classList.add(e.inactiveButtonClass)):(r.disabled=!1,r.classList.remove(e.inactiveButtonClass))},c=function(e,o){return o.some((function(o){return t(e,o)}))},l={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-26",headers:{authorization:"c8502558-7bd8-4793-be9b-945d08eb74d9","Content-Type":"application/json"}};function i(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u=function(e){return fetch("".concat(l.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return i(e)}))},a=function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return i(e)}))},s=function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return i(e)}))};function m(e,t,o){e.textContent=o?t+"...":t}var p=document.querySelector(".profile__info-edit-button"),f=document.querySelector(".profile-popup"),d=f.querySelector(".popup__form-item_input_name"),S=f.querySelector(".popup__form-item_input_description"),_=document.querySelector(".profile__info-name-text"),y=document.querySelector(".profile__info-description"),v=document.querySelector(".profile__avatar-edit"),h=document.querySelector(".avatar-popup"),b=document.querySelector(".popup__form-item_avatar_link"),q=document.querySelector(".profile__avatar"),g=document.querySelector(".page"),C=document.querySelectorAll(".popup"),E={};function L(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}function k(e){e.classList.add(E.openedFormClass),g.addEventListener("keydown",L)}function x(e){e.classList.remove(E.openedFormClass),g.removeEventListener("keydown",L)}var A,w,D=document.querySelector(".places__elements"),U=document.querySelector(".new-item-popup"),j=U.querySelector(".popup__form"),P=document.querySelector(".profile__add-button"),O=document.querySelector(".preview-popup"),T=O.querySelector(".popup__image"),B=O.querySelector(".popup__comment"),F=U.querySelector(".popup__form-item_input_name"),I=U.querySelector(".popup__form-item_input_description"),N=document.querySelector(".profile__info-name-text"),J=document.querySelector(".profile__info-description"),M=document.querySelector(".profile__avatar"),H={},V="";function z(e){D.prepend(e)}function G(e){e.preventDefault();var t,o={name:F.value,link:I.value};m(e.submitter,"Создать",!0),(t=o,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify(t)}).then((function(e){return i(e)}))).then((function(e){z(K(e.name,e.link,0,e.owner._id,e._id)),x(U)})).catch((function(e){console.log(e)})).finally((function(){m(e.submitter,"Создать",!0)}))}function K(e,t,o,r,n){var c=document.querySelector(H.placeElementID).content.querySelector(H.elementSelector).cloneNode(!0),l=c.querySelector(H.imageSelector),i=c.querySelector(H.counterSelector),m=c.querySelector(H.deleteSelector);return c._id=n,c.querySelector(H.textSelector).textContent=e,i.textContent=o>0?""+o:"",V!==r?m.classList.add("element__delete_hidden"):m.classList.remove("element__delete_hidden"),l.alt=e,l.src=t,l.addEventListener("click",(function(e){B.textContent=e.target.closest(H.elementSelector).querySelector(H.textSelector).textContent,T.alt=e.target.alt,T.src=e.target.src,k(O)})),c.querySelector(H.likeSelector).addEventListener("click",(function(e){e.target.classList.contains(H.activeLikeClass)?s(e.target.closest(H.elementSelector)._id).then((function(t){t.likes.length>0?e.target.closest(H.elementSelector).querySelector(H.counterSelector).textContent=""+t.likes.length:e.target.closest(H.elementSelector).querySelector(H.counterSelector).textContent=""})).catch((function(e){console.log(e)})):a(e.target.closest(H.elementSelector)._id).then((function(t){e.target.closest(H.elementSelector).querySelector(H.counterSelector).textContent=""+t.likes.length})).catch((function(e){console.log(e)})),e.target.classList.toggle(H.activeLikeClass)})),m.addEventListener("click",(function(e){u(e.target.closest(H.elementSelector)._id).then((function(t){e.target.closest(H.elementSelector).remove()})).catch((function(e){console.log(e)}))})),c}function Q(){j.reset();var e=Array.from(j.querySelectorAll(H.itemSelector)),o=j.querySelector(H.buttonSelector);e.forEach((function(e){t(j,e)})),o&&n(j,e,o),k(U)}function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function W(e,t,o){return(t=function(e){var t=function(e,t){if("object"!==R(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!==R(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===R(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}!function(o){e=Object.assign({},{pageSelector:".page",formSelector:".popup__form",inputSelector:".popup__form-item",submitButtonSelector:".popup__form-button-save",linkID:"place-link",linkAvatarID:"avatar-link",inactiveButtonClass:"popup__form-button-save_disabled",inputErrorClass:"popup__form-item_type-error",errorClass:"popup__form-item-error_active"});var r=document.querySelector(e.pageSelector);Array.from(r.querySelectorAll(e.formSelector)).forEach((function(o){o.addEventListener("submit",(function(e){e.preventDefault()})),function(o){var r=Array.from(o.querySelectorAll(e.inputSelector)),c=o.querySelector(e.submitButtonSelector);r.forEach((function(e){e.addEventListener("input",(function(){t(o,e),c&&n(o,r,c)}))}))}(o)}))}(),w={itemSelector:".popup__form-item",buttonSelector:".popup__form-button-save",popupSelector:".popup",openedFormClass:"popup_opened",popupClass:"popup",closeClass:"popup__button-close"},E=Object.assign({},w),p.addEventListener("click",(function(){d.value=_.textContent,S.value=y.textContent;var e=Array.from(f.querySelectorAll(E.itemSelector)),o=f.querySelector(E.buttonSelector);e.forEach((function(e){t(f,e)})),o&&n(f,e,o),k(f)})),v.addEventListener("click",(function(){b.value=q.src;var e=Array.from(h.querySelectorAll(E.itemSelector)),o=h.querySelector(E.buttonSelector);e.forEach((function(e){t(h,e)})),o&&n(h,e,o),k(h)})),f.addEventListener("submit",(function(e){e.preventDefault();var t={name:d.value,about:S.value};m(e.submitter,"Сохранить",!0),function(e){return fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify(e)}).then((function(e){return i(e)}))}(t).then((function(e){_.textContent=e.name,y.textContent=e.about,x(f)})).catch((function(e){console.log(e)})).finally((function(){m(e.submitter,"Сохранить",!1)}))})),h.addEventListener("submit",(function(e){e.preventDefault(),m(e.submitter,"Сохранить",!0),function(e){return fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then((function(e){return i(e)}))}(b.value).then((function(e){q.src=e.avatar,x(h)})).catch((function(e){console.log(e)})).finally((function(){m(e.submitter,"Сохранить",!1)}))})),C.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains(E.openedFormClass)&&x(e),t.target.classList.contains(E.closeClass)&&x(e)}))})),function(e){H=Object.assign({},e),Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return i(e)})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(e){return i(e)}))]).then((function(e){N.textContent=e[0].name,J.textContent=e[0].about,M.src=e[0].avatar,V=e[0]._id,e[1].forEach((function(e){z(K(e.name,e.link,e.likes.length,e.owner._id,e._id))}))})).catch((function(e){console.log(e)})),U.addEventListener("submit",G),P.addEventListener("click",Q)}((W(A={placeElementID:"#place-element",elementSelector:".element-item",imageSelector:".element__image",textSelector:".element__text"},"elementSelector",".element"),W(A,"likeSelector",".element__like"),W(A,"deleteSelector",".element__delete"),W(A,"activeLikeClass","element__like_active"),W(A,"itemSelector",".popup__form-item"),W(A,"buttonSelector",".popup__form-button-save"),W(A,"counterSelector",".element__like-counter"),A))})();